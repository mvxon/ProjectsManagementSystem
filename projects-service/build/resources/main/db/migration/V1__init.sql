CREATE TABLE users
(
id             INT8 GENERATED BY DEFAULT AS IDENTITY,
email          VARCHAR(255),
first_name     VARCHAR(255),
last_name      VARCHAR(255),
role           VARCHAR(255),
password       VARCHAR(255),
PRIMARY KEY (id)
);

CREATE TABLE projects
(
id             INT8 GENERATED BY DEFAULT AS IDENTITY,
creation_date  DATE,
customer       VARCHAR(255),
dead_line_date DATE,
update_date    DATE,
status         VARCHAR(255),
deleted        BOOLEAN,
description    VARCHAR(2048),
name           VARCHAR(255),
title          VARCHAR(255),
PRIMARY KEY (id)
);

CREATE TABLE projects_employees
(
project_id     INT8 NOT NULL,
employee_id    INT8 NOT NULL,
PRIMARY KEY (project_id, employee_id)
);

CREATE TABLE tasks
(
id             INT8 GENERATED BY DEFAULT AS IDENTITY,
creation_date  DATE,
dead_line_date DATE,
update_date    DATE,
status         VARCHAR(255),
deleted        BOOLEAN,
description    VARCHAR(2048),
title          VARCHAR(255),
project_id     INT8,
PRIMARY KEY (id)
);

CREATE TABLE tasks_employees
(
task_id        INT8 NOT NULL,
employee_id    INT8 NOT NULL,
PRIMARY KEY (task_id, employee_id)
);

ALTER TABLE IF EXISTS projects
    ADD CONSTRAINT projects_name UNIQUE (name);
ALTER TABLE IF EXISTS users
    ADD CONSTRAINT users_email UNIQUE (email);
ALTER TABLE IF EXISTS projects_employees
    ADD CONSTRAINT projects_employees_fk FOREIGN KEY (employee_id) REFERENCES users;
ALTER TABLE IF EXISTS projects_employees
    ADD CONSTRAINT employees_projects_fk FOREIGN KEY (project_id) REFERENCES projects;
ALTER TABLE IF EXISTS tasks
    ADD CONSTRAINT projects_tasks_fk FOREIGN KEY (project_id) REFERENCES projects;
ALTER TABLE IF EXISTS tasks_employees
    ADD CONSTRAINT tasks_employees_fk FOREIGN KEY (employee_id) REFERENCES users;
ALTER TABLE IF EXISTS tasks_employees
    ADD CONSTRAINT employees_tasks_fk FOREIGN KEY (task_id) REFERENCES tasks;